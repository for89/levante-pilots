---
title: "TOM IRT Models"
author: "Adani Abutto"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: cosmo
    highlight: tango

header-includes:
    - \usepackage{setspace}\doublespacing
---

# Background Info

Info on data structure:
<https://docs.google.com/document/d/1v-nqBxk3R9cSbvJshaBsWQp7KUtBjQSdMNXHw9NDfKg/edit?tab=t.0#heading=h.c60fcjq089m>

Item descriptions:
<https://docs.google.com/document/d/1JKKrdS3_JjbLTuF682KqIoDpWIeeMhrOdfQn0Lt1Dv0/edit?tab=t.0>

------------------------------------------------------------------------------------------

# Setup

```{r setup, include = F, message = F, warning = F}

# load relevant libraries and functions
library(here)
library(glue)
library(png)           # for working with images
library(grid)
library(mirt)          # for IRT models
library(patchwork)     # for multiple plots
library(tidyverse)     # for everything else
library(dplyr)

# set default code chunk options
knitr::opts_chunk$set(echo = T, warning = F, message = F)

# set default plot theme 
theme_set(theme_classic() + 
            theme(text = element_text(size = 18))) 

# fix print width for knitted doc
options(width = 70)

# set random seed
set.seed(1)

```

```{r}

# read in the data
tom_data_long =
  read_rds(here("01_fetched_data/task_data_nested.rds")) %>%
  # keep only tom tasks
  filter(item_task == "tom",
         # keep only Canada, Colombia, Germany
         site %in% c("ca_pilot", "co_pilot", "de_pilot")) %>%
  # unnest
  unnest(data) %>%
  # rename group to site
  rename(group = site) %>%
  # filter out missing item uids
  filter(!is.na(item_uid)) %>%
  # convert booleans to numeric
  mutate(correct = unlist(correct)) %>%
  mutate(correct = case_when(correct == T ~ 1,
                             correct == F ~ 0,
                             TRUE ~ NA_real_))

```

```{r}

# number of items
Hmisc::describe(tom_data_long$item)

# number of item groups
Hmisc::describe(tom_data_long$item_group)

# test sites
Hmisc::describe(tom_data_long$dataset)

```

There are 6 **item groups** (deception, interpretation, moral reasoning, reality/false
belief, reference, and second order), spanning **19 items** total.

There are also **three test sites**: CA, CO, and DE

For each, there are **four different IRT models** to run:

1.  1PL/Rasch model
2.  1PL/Rasch model but with configural scoring
3.  2PL model
4.  2PL model but with configural scoring

------------------------------------------------------------------------------------------

# IRT Models

```{r}

tom_irt_data =
  tom_data_long %>%
  select(user_id, group, item, item_uid,
         item_group, response, answer, correct) %>%
  pivot_wider(names_from = item_uid,
              values_from = correct) %>%
  column_to_rownames("user_id")

# Fit Rasch (1PL) model
mod_rasch =
  mirt(tom_irt_data,
       1,
       itemtype = "Rasch")


```
